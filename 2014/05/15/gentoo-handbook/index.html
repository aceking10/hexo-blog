
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>Gentoo Linux详解 | 铭鉴</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="Ace King">
    
    <meta name="description" content="前期准备
远程登录：

开启ssh服务：

1/etc/init.d/sshd start


设置密码：

1passwd

以便使用putty、ssh client远程登录上传stage等（有时在线下载很慢，而局域网上传很快）
准备磁盘：

分区：

1fdisk /dev/sda


/dev">
    
    
    
    
    <link rel="alternate" href="http://aceking.gitcafe.com/atom.xml" title="铭鉴" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/pacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/pacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">

</head>

  <body>
    <header>
      <div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="铭鉴" title="铭鉴"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="铭鉴">铭鉴</a></h1>
				<h2 class="blog-motto">X= 铭之，以为鉴！</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					
						<li><a href="/">主页</a></li>
					
						<li><a href="/archives">归档</a></li>
					
						<li><a href="/categories">分类</a></li>
					
						<li><a href="/tags">标签</a></li>
					
						<li><a href="/about">关于</a></li>
					
					<li>
					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:aceking.gitcafe.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2014/05/15/gentoo-handbook/" title="Gentoo Linux详解" itemprop="url">Gentoo Linux详解</a>
  </h1>
  <p class="article-author">By
    
      <a href="http://aceking.gitcafe.com" title="Ace King">Ace King</a>
    </p>
  <p class="article-time">
    <time datetime="2014-05-15T10:11:36.000Z" itemprop="datePublished">5月 15 2014</time>
    更新日期:<time datetime="2014-11-14T09:14:49.000Z" itemprop="dateModified">11月 14 2014</time>
    
  </p>
</header>
	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#前期准备"><span class="toc-number">1.</span> <span class="toc-text">前期准备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#远程登录："><span class="toc-number">1.1.</span> <span class="toc-text">远程登录：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#准备磁盘："><span class="toc-number">1.2.</span> <span class="toc-text">准备磁盘：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装系统"><span class="toc-number">2.</span> <span class="toc-text">安装系统</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#安装stage及portage："><span class="toc-number">2.1.</span> <span class="toc-text">安装stage及portage：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#编译前准备："><span class="toc-number">2.2.</span> <span class="toc-text">编译前准备：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Chroot进入新系统环境："><span class="toc-number">3.</span> <span class="toc-text">Chroot进入新系统环境：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Chroot："><span class="toc-number">3.1.</span> <span class="toc-text">Chroot：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#新环境配置："><span class="toc-number">3.2.</span> <span class="toc-text">新环境配置：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#编译内核："><span class="toc-number">4.</span> <span class="toc-text">编译内核：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#手动编译内核："><span class="toc-number">4.1.</span> <span class="toc-text">手动编译内核：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用genkernel编译内核："><span class="toc-number">4.2.</span> <span class="toc-text">使用genkernel编译内核：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置系统"><span class="toc-number">5.</span> <span class="toc-text">配置系统</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#系统信息："><span class="toc-number">5.1.</span> <span class="toc-text">系统信息：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装系统工具软件："><span class="toc-number">5.2.</span> <span class="toc-text">安装系统工具软件：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置启动项："><span class="toc-number">5.3.</span> <span class="toc-text">配置启动项：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#重启系统:"><span class="toc-number">5.4.</span> <span class="toc-text">重启系统:</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装X桌面环境："><span class="toc-number">6.</span> <span class="toc-text">安装X桌面环境：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#安装Xorg："><span class="toc-number">6.1.</span> <span class="toc-text">安装Xorg：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装桌面环境："><span class="toc-number">6.2.</span> <span class="toc-text">安装桌面环境：</span></a></li></ol></li></ol>
		</div>
		
		<h2 id="前期准备">前期准备</h2>
<h3 id="远程登录：">远程登录：</h3>
<ul>
<li>开启ssh服务：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/etc/<span class="keyword">init</span>.d/sshd start</div></pre></td></tr></table></figure>

<ul>
<li>设置密码：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">passwd</div></pre></td></tr></table></figure>

<p>以便使用putty、ssh client远程登录上传stage等（有时在线下载很慢，而局域网上传很快）</p>
<h3 id="准备磁盘：">准备磁盘：</h3>
<ul>
<li>分区：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">fdisk <span class="regexp">/dev/</span>sda</div></pre></td></tr></table></figure>

<blockquote>
<p>/dev/sda1 : /boot 100M(32-100M)  设启动笔记-a<br>/dev/sda2 : / 20G<br>/dev/sda3 : /home 20G<br> /dev/sda5 : /swap 1G (内存&lt; 512 MB,分区分配2倍内存大小的空间;&gt; 1024 MB，可以分配较少的空间甚至不需要swap 分区。)-t 82</p>
</blockquote>
<ul>
<li>创建文件系统：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">mkfs.ext4 <span class="regexp">/dev/</span>sda1</div><div class="line">mkfs.ext4 <span class="regexp">/dev/</span>sda2</div><div class="line">mkfs.ext4 <span class="regexp">/dev/</span>sda3</div><div class="line">mkswap <span class="regexp">/dev/</span>sda5</div></pre></td></tr></table></figure>

<ul>
<li>挂载分区：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">mount /dev/sda2 /mnt/gentoo</div><div class="line"><span class="built_in">mkdir</span> /mnt/gentoo/boot</div><div class="line">mount /dev/sda1 /mnt/gentoo/boot</div><div class="line"><span class="built_in">mkdir</span> /mnt/gentoo/home</div><div class="line">mount /dev/sda3 /mnt/gentoo/home</div><div class="line">swapon /dev/sda5</div></pre></td></tr></table></figure>

<h2 id="安装系统">安装系统</h2>
<h3 id="安装stage及portage：">安装stage及portage：</h3>
<ul>
<li>正确设置日期／时间：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">date</span></div></pre></td></tr></table></figure>

<blockquote>
<p>如果显示的日期／时间不正确，可以使用date MMDDhhmmYYYY命令</p>
</blockquote>
<ul>
<li>下载Stage3 Tarbll：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd /mnt/gentoo</div><div class="line">links <span class="symbol">http:</span>/<span class="regexp">/www.gentoo.org/main</span><span class="regexp">/en/mirrors</span>.xml</div></pre></td></tr></table></figure>

<p>选择国内速度较快的镜像，进入releases/x86/autobuilds/目录里。你将会看到所有适合你的计算机体系结构的stage文件（它们也可能放在各个独立的子体系名称的子目录里）。选择一个，然后按D来下载。下载完以后，再按Q退出浏览器。</p>
<blockquote>
<p>或使用SSH Secure Shell登录上传stage3文件</p>
</blockquote>
<ul>
<li>解开Stage3 Tarball：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="title">tar</span> xvjpf stage3-<span class="regexp">*.tar.bz</span>2</div></pre></td></tr></table></figure>

<ul>
<li>下载Portage：</li>
</ul>
<p>打开links（或者lynx）然后到我们的Gentoo镜像列表。选择一个离你最近的镜像，打开snapshots/目录。然后选择最新的Portage快照（portage-latest.tar.bz2）并按D来下载它。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">links <span class="symbol">http:</span>/<span class="regexp">/www.gentoo.org/main</span><span class="regexp">/en/mirrors</span>.xml</div></pre></td></tr></table></figure>

<blockquote>
<p>或使用SSH Secure Shell登录上传portage文件</p>
</blockquote>
<ul>
<li>解压Portage：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tar -xvjf <span class="regexp">/mnt/g</span>entoo<span class="regexp">/portage-latest.tar.bz2 -C /m</span>nt<span class="regexp">/gentoo/</span>usr （install a Portage snapshot）</div></pre></td></tr></table></figure>

<h3 id="编译前准备：">编译前准备：</h3>
<ul>
<li>配置编译选项：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nano -<span class="keyword">w</span> /mnt/gentoo/etc/portage/<span class="keyword">make</span>.<span class="keyword">conf</span></div></pre></td></tr></table></figure>

<blockquote>
<p>CFLAGS=”-march=native -O2 -pipe”<br>CXXFLAGS=”${CFLAGS}”  # 两个变量使用相同的设置<br>MAKEOPTS=”-j3”  #MAKEOPTS定义在安装软件的时候同时可以产生并行编译的数目，CPU数目加一是个不错的选择</p>
</blockquote>
<p>查看cpu信息：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat <span class="keyword">proc</span>/cpuinfo</div></pre></td></tr></table></figure>

<ul>
<li>选择镜像站点：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="input"><span class="prompt">mirrorselect -i -o &gt;&gt;</span> /mnt/gentoo/etc/portage/make.conf</span></div><div class="line"><span class="input"><span class="prompt">mirrorselect -i -r -o &gt;&gt;</span> /mnt/gentoo/etc/portage/make.conf</span></div></pre></td></tr></table></figure>

<ul>
<li>拷贝DNS信息：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cp -L <span class="regexp">/etc/</span>resolv.conf <span class="regexp">/mnt/g</span>entoo<span class="regexp">/etc/</span></div></pre></td></tr></table></figure>

<h2 id="Chroot进入新系统环境：">Chroot进入新系统环境：</h2>
<h3 id="Chroot：">Chroot：</h3>
<ul>
<li>挂载 /proc, /dev, /sys文件系统：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mount -t <span class="keyword">proc</span> none /mnt/gentoo/<span class="keyword">proc</span></div><div class="line">mount --rbind /dev /mnt/gentoo/dev</div><div class="line">mount --rbind /sys /mnt/gentoo/sys</div></pre></td></tr></table></figure>

<ul>
<li>进入新的系统环境：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">chroot <span class="regexp">/mnt/g</span>entoo <span class="regexp">/bin/</span>bash</div><div class="line"><span class="keyword">source</span> <span class="regexp">/etc/</span>profile</div><div class="line">export PS1=<span class="string">"(chroot) $PS1"</span></div></pre></td></tr></table></figure>

<h3 id="新环境配置：">新环境配置：</h3>
<ul>
<li>更新portage树：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">emerge <span class="comment">--sync （Updating the Portage tree）</span></div><div class="line">或</div><div class="line">emerge-webrsync（fetch <span class="operator">the</span> latest portage snapshot）</div></pre></td></tr></table></figure>

<ul>
<li>选择Profile：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">eselect <span class="keyword">profile</span> <span class="keyword">list</span></div><div class="line">eselect <span class="keyword">profile</span> <span class="keyword">set</span> ×</div></pre></td></tr></table></figure>

<ul>
<li>设置时区：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">ls</span> /usr/share/zoneinfo</div><div class="line"><span class="keyword">echo</span> <span class="string">"Europe/Brussels"</span> &gt; /etc/timezone</div><div class="line">emerge --config sys-libs/timezone-data</div></pre></td></tr></table></figure>

<ul>
<li>设置locale：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">nano -w <span class="regexp">/etc/</span>locale.gen</div><div class="line">locale-gen</div></pre></td></tr></table></figure>

<ul>
<li>更新环境变量：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">env-<span class="keyword">update</span> && <span class="keyword">source</span> /etc/<span class="keyword">profile</span></div></pre></td></tr></table></figure>

<p>`</p>
<h2 id="编译内核：">编译内核：</h2>
<ul>
<li>安装内核源码：</li>
</ul>
<p>选择内核：如gentoo-sources</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">emerge gentoo-sources</div><div class="line">ls <span class="operator">-l</span> /usr/src/linux</div></pre></td></tr></table></figure>

<h3 id="手动编译内核：">手动编译内核：</h3>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">cd</span> /usr/src/linux</div><div class="line"><span class="keyword">make</span> menuconfig</div></pre></td></tr></table></figure>

<ul>
<li>必须启用的选项：</li>
</ul>
<p>显卡：<a href="https://wiki.gentoo.org/wiki/Xorg/Configuration" target="_blank" rel="external">Xorg/Configuration</a><br>声卡：<a href="https://wiki.gentoo.org/wiki/ALSA" target="_blank" rel="external">ALSA</a><br>网卡：根据具体网卡芯片型号，查看wiki。<br>无线网卡芯片驱动查询：<a href="http://wireless.kernel.org/en/users/Devices/PCI" target="_blank" rel="external">Linux Wireless</a></p>
<blockquote>
<p>其他选项根据需要添加，不了解保持默认即可.</p>
</blockquote>
<ul>
<li>编译内核与模块：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">make</span> && <span class="keyword">make</span> modules_install</div></pre></td></tr></table></figure>

<ul>
<li>拷贝内核到启动分区：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">cp</span> arch/x86_64/boot/bzImage /boot/kernel-<span class="number">3.10</span>.<span class="number">10</span>-gentoo</div><div class="line">或</div><div class="line"><span class="keyword">make</span> install  #使用<span class="keyword">make</span> install</div></pre></td></tr></table></figure>

<blockquote>
<p>This will copy the kernel image into /boot together with the System.map file and the kernel configuration file. </p>
</blockquote>
<h3 id="使用genkernel编译内核：">使用genkernel编译内核：</h3>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="title">emerge</span> genkernel</div></pre></td></tr></table></figure>

<ul>
<li>可选：复制安装光盘上的内核配置文件：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">zcat /<span class="keyword">proc</span>/config.gz &gt; /usr/share/genkernel/arch/x86_64/kernel-config</div></pre></td></tr></table></figure>

<ul>
<li>编译：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">genkernel --menuconfig <span class="literal">all</span></div></pre></td></tr></table></figure>

<p>一旦genkernel运行完成，一个包括全部模块和initrd的内核将被建立。在后面配置引导程序时我们将会用到这个内核和initrd。请记下内核和initrd的名字，因为您将在配置引导程序的时候用到他们(Grub Legacy使用)。initrd将会在启动真正的系统前自动识别硬件（如同安装光盘一样）。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ls /boot/kernel<span class="keyword">*</span> /boot/initramfs<span class="keyword">*</span></div></pre></td></tr></table></figure>

<h2 id="配置系统">配置系统</h2>
<h3 id="系统信息：">系统信息：</h3>
<ul>
<li>文件系统信息：</li>
</ul>
<p>创建/etc/fstab</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nano -w <span class="regexp">/etc/</span>fstab</div></pre></td></tr></table></figure>

<ul>
<li>网络信息：</li>
</ul>
<p>Host name, Domainname, etc</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nano -<span class="keyword">w</span> /etc/<span class="keyword">conf</span>.<span class="keyword">d</span>/<span class="built_in">hostname</span></div></pre></td></tr></table></figure>

<p>Configuring Network</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nano -<span class="keyword">w</span> /etc/<span class="keyword">conf</span>.<span class="keyword">d</span>/net</div></pre></td></tr></table></figure>

<ul>
<li>系统信息：</li>
</ul>
<p>Gentoo uses /etc/rc.conf to configure the services, startup, and shutdown of your system.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nano -<span class="keyword">w</span> /etc/rc.<span class="keyword">conf</span></div></pre></td></tr></table></figure>

<p>Root Password</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">passwd</div></pre></td></tr></table></figure>

<p>Gentoo uses /etc/conf.d/hwclock to set clock options.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nano -<span class="keyword">w</span> /etc/<span class="keyword">conf</span>.<span class="keyword">d</span>/hwclock</div></pre></td></tr></table></figure>

<h3 id="安装系统工具软件：">安装系统工具软件：</h3>
<ul>
<li>可选：PCMCIA使用lspci查看硬件信息：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="title">emerge</span> pcmciautils</div></pre></td></tr></table></figure>

<ul>
<li>System Logger：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">emerge syslog-ng</div><div class="line">rc-<span class="operator"><span class="keyword">update</span> <span class="keyword">add</span> syslog-ng <span class="keyword">default</span></span></div></pre></td></tr></table></figure>

<ul>
<li>可选：File Indexing：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="title">emerge</span> mlocate</div></pre></td></tr></table></figure>

<ul>
<li>可选：Remote Access：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rc-<span class="operator"><span class="keyword">update</span> <span class="keyword">add</span> sshd <span class="keyword">default</span></span></div></pre></td></tr></table></figure>

<ul>
<li>可选：DHCP Client：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="title">emerge</span> dhcpcd</div></pre></td></tr></table></figure>

<h3 id="配置启动项：">配置启动项：</h3>
<ul>
<li>Using GRUB2：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">emerge sys-boot/grub</div><div class="line">grub2-<span class="operator"><span class="keyword">install</span> /dev/sda</span></div></pre></td></tr></table></figure>

<p>Generating GRUB2 configuration：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">grub2-mkconfig -o <span class="regexp">/boot/g</span>rub<span class="regexp">/grub.cfg</span></div></pre></td></tr></table></figure>

<ul>
<li>可选：Using GRUB Legacy：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">emerge sys-boot/gru<span class="variable">b:0</span></div></pre></td></tr></table></figure>

<p>编辑配置文件：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nano -<span class="keyword">w</span> /boot/grub/grub.<span class="keyword">conf</span></div></pre></td></tr></table></figure>

<p>Example grub.conf：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="preprocessor"># 默认选择哪个列表来引导。0表示第一个， 1表示第二个，以此类推。</span></div><div class="line"><span class="keyword">default</span> <span class="number">0</span></div><div class="line"><span class="preprocessor"># 引导默认列表前等待多少秒</span></div><div class="line">timeout <span class="number">30</span></div><div class="line"><span class="preprocessor"># 使用漂亮、“臃肿”的spalsh图像来增加一点趣味:)</span></div><div class="line"><span class="preprocessor"># 如果您没有安装显卡，请将这行注释掉</span></div><div class="line">splashimage=(hd0,<span class="number">0</span>)/boot/grub/splash.xpm.gz</div><div class="line"></div><div class="line">title Gentoo Linux <span class="number">3.10</span><span class="number">.10</span></div><div class="line"><span class="preprocessor"># 内核镜像（或者操作系统）所在分区</span></div><div class="line">root (hd0,<span class="number">0</span>)</div><div class="line">kernel /boot/kernel-<span class="number">3.10</span><span class="number">.10</span>-gentoo root=/dev/sda2</div><div class="line"></div><div class="line">title Gentoo Linux <span class="number">3.10</span><span class="number">.10</span> (rescue)</div><div class="line"><span class="preprocessor"># 内核镜像（或者操作系统）所在分区</span></div><div class="line">root (hd0,<span class="number">0</span>)</div><div class="line">kernel /boot/kernel-<span class="number">3.10</span><span class="number">.10</span>-gentoo root=/dev/sda2 init=/bin/bb</div><div class="line"></div><div class="line"><span class="preprocessor"># 接下来的四行只有在您与Windows系统进行双启动的情况下才需要。</span></div><div class="line"><span class="preprocessor"># 本例中，windows系统位于/dev/sda6。</span></div><div class="line">title Windows XP</div><div class="line">rootnoverify (hd0,<span class="number">5</span>)</div><div class="line">makeactive</div><div class="line">chainloader +<span class="number">1</span></div><div class="line"></div><div class="line"><span class="preprocessor">#win7下注释掉makeactive</span></div></pre></td></tr></table></figure>

<p>Setting up GRUB Legacy using grub-install:<br>Creating /etc/mtab:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">grep -v rootfs /<span class="keyword">proc</span>/mounts &gt; /etc/mtab</div></pre></td></tr></table></figure>

<p>Install GRUB Legacy:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">grub-<span class="operator"><span class="keyword">install</span> <span class="comment">--no-floppy /dev/sda</span></span></div></pre></td></tr></table></figure>

<h3 id="重启系统:">重启系统:</h3>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">exit</div><div class="line">cd</div><div class="line">umount -l /mnt/gentoo/dev{/shm,/pts,}</div><div class="line">umount -l /mnt/gentoo{/boot,/<span class="keyword">proc</span>,}</div><div class="line">reboot</div></pre></td></tr></table></figure>

<h2 id="安装X桌面环境：">安装X桌面环境：</h2>
<h3 id="安装Xorg：">安装Xorg：</h3>
<ul>
<li>检测显卡信息：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">dmesg | <span class="keyword">grep</span> video</div><div class="line">lspci  | <span class="keyword">grep</span> -<span class="keyword">i</span> VGA</div></pre></td></tr></table></figure>

<ul>
<li>配置INPUT_DEVICE、VIDEO_CARDS变量：</li>
</ul>
<p>在安装Xorg之前，你需要在/etc/portage/make.conf文件中设置两个重要的变量。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">(For mouse, keyboard, <span class="constant">and</span> Synaptics touchpad support)</div><div class="line"><span class="variable">INPUT_DEVICE=</span><span class="string">"evdev  synaptics"</span>   </div><div class="line">（对nVidia显卡）</div><div class="line"><span class="variable">VIDEO_CARDS=</span><span class="string">"nvidia"</span></div><div class="line">（或，对ATI Radeon显卡）</div><div class="line"><span class="variable">VIDEO_CARDS=</span><span class="string">"radeon"</span></div><div class="line">（VMware虚拟机）</div><div class="line"><span class="variable">VIDEO_CARDS=</span><span class="string">"vmware"</span></div><div class="line">（VirtualBox虚拟机）</div><div class="line"><span class="variable">VIDEO_CARDS=</span><span class="string">"virtualbox"</span></div></pre></td></tr></table></figure>

<ul>
<li>安装xorg-server“</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="title">emerge</span> -pv xorg-drivers</div></pre></td></tr></table></figure>

<p>First of all, make sure udev is in your USE flags:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="input"><span class="prompt">echo "x11-base/xorg-server udev" &gt;&gt;</span> /etc/portage/package.use</span></div></pre></td></tr></table></figure>

<blockquote>
<p>注：现在比较新的版本的Xorg（大概是 1.5 以后的吧） 使用 evdev 替换了 keyboard 和 mouse ，确保 udev 标记在安装 xorg-server 时被启用。</p>
</blockquote>
<p>Next, install Xorg:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">emerge -av xorg-<span class="keyword">server</span></div></pre></td></tr></table></figure>

<ul>
<li>更新环境变量：</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">env-<span class="keyword">update</span> </div><div class="line"><span class="keyword">source</span> /etc/<span class="keyword">profile</span></div></pre></td></tr></table></figure>

<ul>
<li>使用startx：</li>
</ul>
<p>安装 twm 和 xterm 之后 执行 startx 测试 X 是否正常。<br>测试正常之后可以删除 twm 和 xterm。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="title">emerge</span> -v twm xterm</div><div class="line">startx</div></pre></td></tr></table></figure>

<h3 id="安装桌面环境：">安装桌面环境：</h3>
<ul>
<li>lxde：</li>
<li>awesome：</li>
</ul>
  
	</div>
		<footer class="article-footer clearfix">

  <div class="article-tags">
  
  <span></span> <a href="/tags/gentoo/">gentoo</a><a href="/tags/handbook/">handbook</a>
  </div>


<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Gentoo/">Gentoo</a>
</div>



<div class="article-share" id="share">

  <div data-url="http://aceking.gitcafe.com/2014/05/15/gentoo-handbook/" data-title="Gentoo Linux详解 | 铭鉴" data-tsina="null" class="share clearfix">
  </div>

</div>
</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2014/10/10/arch-handbook/" title="Arch Linux安装详解">
  <strong>PREVIOUS:</strong><br/>
  <span>
  Arch Linux安装详解</span>
</a>
</div>


</nav>

	
<section class="comment">
	<div class="ds-thread"></div>
</section>


</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
  <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#前期准备"><span class="toc-number">1.</span> <span class="toc-text">前期准备</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#远程登录："><span class="toc-number">1.1.</span> <span class="toc-text">远程登录：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#准备磁盘："><span class="toc-number">1.2.</span> <span class="toc-text">准备磁盘：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装系统"><span class="toc-number">2.</span> <span class="toc-text">安装系统</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#安装stage及portage："><span class="toc-number">2.1.</span> <span class="toc-text">安装stage及portage：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#编译前准备："><span class="toc-number">2.2.</span> <span class="toc-text">编译前准备：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Chroot进入新系统环境："><span class="toc-number">3.</span> <span class="toc-text">Chroot进入新系统环境：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Chroot："><span class="toc-number">3.1.</span> <span class="toc-text">Chroot：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#新环境配置："><span class="toc-number">3.2.</span> <span class="toc-text">新环境配置：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#编译内核："><span class="toc-number">4.</span> <span class="toc-text">编译内核：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#手动编译内核："><span class="toc-number">4.1.</span> <span class="toc-text">手动编译内核：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用genkernel编译内核："><span class="toc-number">4.2.</span> <span class="toc-text">使用genkernel编译内核：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置系统"><span class="toc-number">5.</span> <span class="toc-text">配置系统</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#系统信息："><span class="toc-number">5.1.</span> <span class="toc-text">系统信息：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装系统工具软件："><span class="toc-number">5.2.</span> <span class="toc-text">安装系统工具软件：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置启动项："><span class="toc-number">5.3.</span> <span class="toc-text">配置启动项：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#重启系统:"><span class="toc-number">5.4.</span> <span class="toc-text">重启系统:</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安装X桌面环境："><span class="toc-number">6.</span> <span class="toc-text">安装X桌面环境：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#安装Xorg："><span class="toc-number">6.1.</span> <span class="toc-text">安装Xorg：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#安装桌面环境："><span class="toc-number">6.2.</span> <span class="toc-text">安装桌面环境：</span></a></li></ol></li></ol>
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
			<li><a href="/categories/Arch/" title="Arch">Arch<sup>1</sup></a></li>
		
			<li><a href="/categories/Gentoo/" title="Gentoo">Gentoo<sup>1</sup></a></li>
		
			<li><a href="/categories/Git/" title="Git">Git<sup>1</sup></a></li>
		
			<li><a href="/categories/Hexo/" title="Hexo">Hexo<sup>1</sup></a></li>
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			<li><a href="/tags/arch/" title="arch">arch<sup>1</sup></a></li>
		
			<li><a href="/tags/blog/" title="blog">blog<sup>1</sup></a></li>
		
			<li><a href="/tags/gentoo/" title="gentoo">gentoo<sup>1</sup></a></li>
		
			<li><a href="/tags/git/" title="git">git<sup>1</sup></a></li>
		
			<li><a href="/tags/handbook/" title="handbook">handbook<sup>2</sup></a></li>
		
			<li><a href="/tags/hexo/" title="hexo">hexo<sup>1</sup></a></li>
		
		</ul>
</div>


  
  <div class="archiveslist">
    <p class="asidetitle"><a href="/archives">归档</a></p>
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">November 2014</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10/">October 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/05/">May 2014</a><span class="archive-list-count">1</span></li></ul>
  </div>


  
  <div class="tagcloudlist">
    <p class="asidetitle">标签云</p>
    <div class="tagcloudlist clearfix">
       <a href="/tags/arch/" style="font-size: 10.00px;">arch</a><a href="/tags/blog/" style="font-size: 10.00px;">blog</a><a href="/tags/gentoo/" style="font-size: 10.00px;">gentoo</a><a href="/tags/git/" style="font-size: 10.00px;">git</a><a href="/tags/handbook/" style="font-size: 20.00px;">handbook</a><a href="/tags/hexo/" style="font-size: 10.00px;">hexo</a>
    </div>
  </div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
      <li><a href="http://yangjian.me" target="_blank" title="YangJian">Alimon's Blog</a></li>
      <li><a href="http://hexo.io" target="_blank" title="Hexo">Hexo</a></li>
    </ul>
</div>


  <div class="rsspart">
	<a href="http://aceking.gitcafe.com/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> 孤逐王--个人博客 <br/>
			X印记：记录极客成长路上的点点滴滴！</p>
	</section>
	 
	<div class="social-font clearfix">
		
		<a href="http://weibo.com/aceking10" target="_blank" title="weibo"></a>
		
		
		
		<a href="https://github.com/aceking10" target="_blank" title="github"></a>
		
		
		
	</div>
		<p class="copyright">Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/A-limon/pacman" target="_blank" title="Pacman">Pacman</a> © 2014 
		
		<a href="http://aceking.gitcafe.com" target="_blank" title="Ace King">Ace King</a>
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});     
</script>


<script type="text/javascript">
  var duoshuoQuery = {short_name:"null"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 





  </body>
</html>
